<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8">
<title>BolMarathi Vision</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.21.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<style>
body {
  font-family: Arial;
  text-align: center;
  background: #f2f2f2;
}

button {
  padding: 10px 16px;
  margin: 6px;
  font-size: 16px;
}

#webcam-container canvas {
  border: 2px solid #333;
}
</style>
</head>

<body>

<h2>ðŸŽ¥ BolMarathi Vision</h2>

<button onclick="startCamera()">Start Camera</button>
<button onclick="toggleFlip()">Flip ON / OFF</button>

<div id="webcam-container"></div>
<h3 id="result">Prediction à¤‡à¤¥à¥‡ à¤¦à¤¿à¤¸à¥‡à¤²</h3>

<script>
const URL = "https://teachablemachine.withgoogle.com/models/WWja4kcwy/";

let model, webcam;
let flip = false;        // ðŸ‘ˆ DEFAULT: NO MIRROR
let lastSpoken = "";

const marathiMap = {
  "A": "à¤…",
  "B": "à¤¬",
  "C": "à¤•",
  "D": "à¤¡"
};

async function startCamera() {
  const modelURL = URL + "model.json";
  const metadataURL = URL + "metadata.json";

  model = await tmImage.load(modelURL, metadataURL);

  webcam = new tmImage.Webcam(300, 300, false); // âŒ NO AUTO FLIP
  await webcam.setup();
  await webcam.play();

  document.getElementById("webcam-container").innerHTML = "";
  document.getElementById("webcam-container").appendChild(webcam.canvas);

  applyFlip();
  window.requestAnimationFrame(loop);
}

function applyFlip() {
  webcam.canvas.style.transform = flip ? "scaleX(-1)" : "scaleX(1)";
}

function toggleFlip() {
  flip = !flip;
  applyFlip();
}

async function loop() {
  webcam.update();
  await predict();
  window.requestAnimationFrame(loop);
}

async function predict() {
  const prediction = await model.predict(webcam.canvas);

  let best = prediction[0];
  for (let p of prediction) {
    if (p.probability > best.probability) best = p;
  }

  if (best.probability > 0.8) {
    const label = best.className;
    const marathi = marathiMap[label] || label;

    document.getElementById("result").innerText =
      label + " â†’ " + marathi;

    if (lastSpoken !== marathi) {
      speakMarathi(marathi);
      lastSpoken = marathi;
    }
  }
}

function speakMarathi(text) {
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = "mr-IN";
  window.speechSynthesis.cancel();
  window.speechSynthesis.speak(msg);
}
</script>

</body>
</html>
